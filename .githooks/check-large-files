#!/bin/bash
# Reject files larger than 50MB
#
# Large files bloat git history. For files over 50MB:
# - Use git-lfs: git lfs track "*.ext" && git add .gitattributes
# - Or add to .gitignore if they can be regenerated

MAX_SIZE=$((50 * 1024 * 1024))  # 50MB in bytes
BLOCKED=0

for file in $(git diff --cached --name-only --diff-filter=ACM); do
    if [ -f "$file" ]; then
        size=$(wc -c < "$file")
        if [ "$size" -gt "$MAX_SIZE" ]; then
            echo "ERROR: $file is $(($size / 1024 / 1024))MB, exceeds 50MB limit"
            BLOCKED=1
        fi
    fi
done

if [ "$BLOCKED" -eq 1 ]; then
    echo ""
    echo "Options:"
    echo "  1. Use git-lfs for large files:"
    echo "     git lfs track \"pattern\" && git add .gitattributes"
    echo "  2. Add to .gitignore if regenerable"
    echo ""
    exit 1
fi
